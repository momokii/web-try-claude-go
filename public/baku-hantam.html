{{ template "base/base-header" . }}

<body>
    
    <div class="container">
        <!--====== PRICING STYLE ONE START ======-->
        <section class="pricing-area pricing-one">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-xxl-6 col-xl-7 col-lg-8">
                        <div class="section-title text-center">
                            <h2 class="mb-3 fw-bold">Baku Hantam Tekbro</h2>
                            <p class="text-lg">
                                Mencoba implementasi prompting analisis pada Claude Sonnet-3.5 API &  GPT-4o dengan melakukan crawling data dari website milik mas <a href="https://x.com/zakiego" target="_blank">@zakiego</a> pada website <a href="https://bakuhantam.dev" target="_blank">Baku Hantam</a>. Dapat memilih topik yang ada pada website tersebut, dan lihat hasilnya.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-6 col-md-6 col-sm-9" id="cardInput">
                        <div class="pricing-style-one d-flex flex-column h-100">
                            <div class="pricing-header text-center">
                                <h3 class="sub-title">Analisis Baku Hantam Tekbro</h3>
                                <h6 class="year mt-3 text-justify">Silahkan pilih topic yang ada dari website terkait pada pilihan di bawah. lalu yaudah coba submit dan lihat hasilnya :).</h6>

                                <div class="form-style form-style-five ">
                                    <div class="row">
                                        <div class="col-lg-12 justify-content-center">
                                            <div class="form-input mt-4">
                                                <form action="post" id="postBakuHantam" method="post">

                                                    <div class="mb-3">
                                                        <small for="topic" class="form-text text-muted text-left fw-bold">Topic</small>
                                                        <select class="form-select" aria-label="Default select example" id="dynamicSelect" name="topic">
                                                            <option selected disabled>Pilih opsi</option>
                                                        </select>
                                                    </div>

                                                    <div class="mb-3">
                                                        <small for="model" class="form-text text-muted text-left fw-bold">LLM Model</small>
                                                        <select name="model" id="model" class="form-select mb-3">
                                                            <option value="claude">Claude</option>
                                                            <option value="gpt">GPT</option>
                                                        </select>
                                                    </div>
                                                    
                                                    <div class="pricing-btn rounded-buttons text-center">
                                                        <button class="btn primary-btn rounded-full" type="submit">
                                                            Pilih
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="bottom-shape">
                                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 350 112.35">
                                    <defs>
                                        <style>
                                            .color-1 {
                                                fill: #2bdbdc;
                                                isolation: isolate;
                                            }

                                            .cls-1 {
                                                opacity: 0.1;
                                            }

                                            .cls-2 {
                                                opacity: 0.2;
                                            }

                                            .cls-3 {
                                                opacity: 0.4;
                                            }

                                            .cls-4 {
                                                opacity: 0.6;
                                            }
                                        </style>
                                    </defs>
                                    <title>bottom-part1</title>
                                    <g>
                                        <g data-name="Group 747">
                                            <path data-name="Path 294" class="cls-1 color-1"
                                                d="M0,24.21c120-55.74,214.32,2.57,267,0S349.18,7.4,349.18,7.4V82.35H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 297" class="cls-2 color-1"
                                                d="M350,34.21c-120-55.74-214.32,2.57-267,0S.82,17.4.82,17.4V92.35H350Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 296" class="cls-3 color-1"
                                                d="M0,44.21c120-55.74,214.32,2.57,267,0S349.18,27.4,349.18,27.4v74.95H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 295" class="cls-4 color-1"
                                                d="M349.17,54.21c-120-55.74-214.32,2.57-267,0S0,37.4,0,37.4v74.95H349.17Z"
                                                transform="translate(0 0)" />
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <!-- single pricing -->
                    </div>
                    
                    <div class="col-lg-10 col-md-10 col-sm-9" id="cardResult" style="display: none;"   >
                        <div class="pricing-style-one d-flex flex-column h-100">
                            <div class="pricing-header text-center">
                                <h3 class="sub-title">Hasil</h3>
                                <h5 class="year mt-3" id="model_answer">Model</h5>
                                <h6 class="year mt-3">Saya cuma nampilin hasilnya ya,  hehe.</h6>
                            </div>
                            <div class="pricing-list">
                                <div class="user-info">
                                    <!-- <img src="./public/test.jpg" alt="User Image" class="rounded-circle mx-auto d-block" style="width: 100px; height: 100px;" id="userphoto"> -->
                                    <h5 class="mt-3 text-center" id="topicNameRes">Topic</h5>
                                    <h5 class="mt-3 text-center"><a id="linkCoordinat" target="_blank">Titik Kumpul</a></h5>
                                </div>

                                <hr>

                                <p class="text text-justify fw-bold bg-white p-3 rounded opacity-90" id="resultRes" ></p>
                            </div>
                            <div class="pricing-btn rounded-buttons text-center">
                                <a class="btn primary-btn rounded-full" href="/baku-hantam">
                                    Ulangi
                                </a>
                            </div>
                            <div class="bottom-shape">
                                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 350 112.35">
                                    <defs>
                                        <style>
                                            .color-1 {
                                                fill: #2bdbdc;
                                                isolation: isolate;
                                            }

                                            .cls-1 {
                                                opacity: 0.1;
                                            }

                                            .cls-2 {
                                                opacity: 0.2;
                                            }

                                            .cls-3 {
                                                opacity: 0.4;
                                            }

                                            .cls-4 {
                                                opacity: 0.6;
                                            }
                                        </style>
                                    </defs>
                                    <title>bottom-part1</title>
                                    <g>
                                        <g data-name="Group 747">
                                            <path data-name="Path 294" class="cls-1 color-1"
                                                d="M0,24.21c120-55.74,214.32,2.57,267,0S349.18,7.4,349.18,7.4V82.35H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 297" class="cls-2 color-1"
                                                d="M350,34.21c-120-55.74-214.32,2.57-267,0S.82,17.4.82,17.4V92.35H350Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 296" class="cls-3 color-1"
                                                d="M0,44.21c120-55.74,214.32,2.57,267,0S349.18,27.4,349.18,27.4v74.95H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 295" class="cls-4 color-1"
                                                d="M349.17,54.21c-120-55.74-214.32,2.57-267,0S0,37.4,0,37.4v74.95H349.17Z"
                                                transform="translate(0 0)" />
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <!-- single pricing -->
                    </div>
                </div>
                <!-- row -->
            </div>
            <!-- container -->
        </section>
        <!--====== PRICING STYLE ONE ENDS ======-->

        <div class="row justify-content-center">
            <div>
                <div class="pricing-btn rounded-buttons text-center mb-5">
                    <a class="btn btn-danger rounded-full" href="/">
                        Kembali
                    </a>
                </div>
            </div>
        </div>
    </div>

    {{ template "base/footer" . }}

    {{ template "components/loading" .}}

    {{ template "components/modal-infor" .}}
</body>

<script>
    // modal initiation
    const modalInfo = new bootstrap.Modal(document.getElementById('infoModal'));

    $(document).ready(async function () {
        const selectElement = $('#dynamicSelect')

        $('#loadingModal').css('display', 'flex')

        try {
            const response = await fetch('/api/baku-hantam/topics', {
                method: 'GET'
            })
            const res = await response.json()

            $('#loadingModal').css('display', 'none')

            if (res.error) {
                $('#modalMessage').html(res.message)
                modalInfo.show()
            } else {
                res.data.topic.forEach(item => {
                    const option = $('<option></option>').text(item.title).val(item.link)
                    selectElement.append(option)
                })
            }
        } catch(e) {
            $('#loadingModal').css('display', 'none')
            $('#modalMessage').html(e.message)
            modalInfo.show()
        }
        

        $('#postBakuHantam').on('submit', async function () {
            const selectElement = $('#dynamicSelect') // get select value

            $('#loadingModal').css('display', 'flex')

            // get card input and card result
            const cardInput = $('#cardInput')
            const cardResult = $('#cardResult')

            const topicNameRes = $('#topicNameRes')
            const linkCoordinat = $('#linkCoordinat')
            const resultRes = $('#resultRes')

            event.preventDefault()

            if(selectElement.val() === '' || selectElement.val() === 'Pilih opsi') {
                $('#loadingModal').css('display', 'none')
                $('#modalMessage').html('<p class="text-danger">Pilih topik dulu kocak</p>')
                modalInfo.show()
                return
            }

            const formData = new FormData(this)
            formData.append('topicName', selectElement[0].options[selectElement[0].selectedIndex].text)
            const model = $('#model').val()

            try {
                const url = '/api/baku-hantam?model=' + model
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                })
                const res = await response.json()

                $('#loadingModal').css('display', 'none')
                if (res.error) {
                    $('#modalMessage').html(res.message)
                    modalInfo.show()
                } else {
                    cardInput.css('display', 'none')
                    cardResult.css('display', 'flex')

                    topicNameRes.html(res.data.topic_name)
                    linkCoordinat.attr('href', res.data.topic)
                    resultRes.html(res.data.content)

                    $('#model_answer').html('Model: ' + model.toUpperCase())
                }

            } catch (e) {
                $('#loadingModal').css('display', 'none')
                $('#modalMessage').html(e.message)
                modalInfo.show()
            }
        })
    })
</script>