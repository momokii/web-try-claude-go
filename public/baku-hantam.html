{{ template "base/base-header" . }}

<body>
    
    <div class="container">
        <!--====== PRICING STYLE ONE START ======-->
        <section class="pricing-area pricing-one">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-xxl-6 col-xl-7 col-lg-8">
                        <div class="section-title text-center">
                            <h2 class="mb-3 fw-bold">Baku Hantam Tekbro</h2>
                            <p class="text-lg">
                                Mencoba implementasi prompting analisis pada Claude Sonnet-3.5 API dengan melakukan crawling data dari website milik mas <a href="https://x.com/zakiego" target="_blank">@zakiego</a> pada website <a href="https://bakuhantam.dev" target="_blank">Baku Hantam</a>. Dapat memilih topik yang ada pada website tersebut, dan lihat hasilnya.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-6 col-md-7 col-sm-9" id="cardInput">
                        <div class="pricing-style-one d-flex flex-column h-100">
                            <div class="pricing-header text-center">
                                <h3 class="sub-title">Analisis Baku Hantam Tekbro</h3>
                                <h6 class="year mt-3 text-justify">Silahkan pilih topic yang ada dari website terkait pada pilihan di bawah. lalu yaudah coba submit dan lihat hasilnya :).</h6>

                                <div class="form-style form-style-five ">
                                    <div class="row">
                                        <div class="col-lg-12 justify-content-center">
                                            <div class="form-input mt-4">
                                                <form action="post" id="postBakuHantam" method="post">
                                                    <select class="form-select" aria-label="Default select example" id="dynamicSelect" name="topic">
                                                        <option selected disabled>Pilih opsi</option>
                                                    </select>
                                                    <div class="pricing-btn rounded-buttons text-center">
                                                        <button class="btn primary-btn rounded-full" type="submit">
                                                            Pilih
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="bottom-shape">
                                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 350 112.35">
                                    <defs>
                                        <style>
                                            .color-1 {
                                                fill: #2bdbdc;
                                                isolation: isolate;
                                            }

                                            .cls-1 {
                                                opacity: 0.1;
                                            }

                                            .cls-2 {
                                                opacity: 0.2;
                                            }

                                            .cls-3 {
                                                opacity: 0.4;
                                            }

                                            .cls-4 {
                                                opacity: 0.6;
                                            }
                                        </style>
                                    </defs>
                                    <title>bottom-part1</title>
                                    <g>
                                        <g data-name="Group 747">
                                            <path data-name="Path 294" class="cls-1 color-1"
                                                d="M0,24.21c120-55.74,214.32,2.57,267,0S349.18,7.4,349.18,7.4V82.35H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 297" class="cls-2 color-1"
                                                d="M350,34.21c-120-55.74-214.32,2.57-267,0S.82,17.4.82,17.4V92.35H350Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 296" class="cls-3 color-1"
                                                d="M0,44.21c120-55.74,214.32,2.57,267,0S349.18,27.4,349.18,27.4v74.95H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 295" class="cls-4 color-1"
                                                d="M349.17,54.21c-120-55.74-214.32,2.57-267,0S0,37.4,0,37.4v74.95H349.17Z"
                                                transform="translate(0 0)" />
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <!-- single pricing -->
                    </div>
                    
                    <div class="col-lg-10 col-md-7 col-sm-9" id="cardResult" style="display: none;"   >
                        <div class="pricing-style-one d-flex flex-column h-100">
                            <div class="pricing-header text-center">
                                <h3 class="sub-title">Hasil</h3>
                                <h6 class="year mt-3">Saya cuma nampilin hasilnya ya,  hehe.</h6>
                            </div>
                            <div class="pricing-list">
                                <div class="user-info">
                                    <!-- <img src="./public/test.jpg" alt="User Image" class="rounded-circle mx-auto d-block" style="width: 100px; height: 100px;" id="userphoto"> -->
                                    <h5 class="mt-3 text-center" id="topicNameRes">Topic</h5>
                                    <h5 class="mt-3 text-center"><a id="linkCoordinat" target="_blank">Titik Kumpul</a></h5>
                                </div>

                                <hr>

                                <p class="text text-justify" id="resultRes"></p>
                            </div>
                            <div class="pricing-btn rounded-buttons text-center">
                                <a class="btn primary-btn rounded-full" href="/baku-hantam">
                                    Ulangi
                                </a>
                            </div>
                            <div class="bottom-shape">
                                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 350 112.35">
                                    <defs>
                                        <style>
                                            .color-1 {
                                                fill: #2bdbdc;
                                                isolation: isolate;
                                            }

                                            .cls-1 {
                                                opacity: 0.1;
                                            }

                                            .cls-2 {
                                                opacity: 0.2;
                                            }

                                            .cls-3 {
                                                opacity: 0.4;
                                            }

                                            .cls-4 {
                                                opacity: 0.6;
                                            }
                                        </style>
                                    </defs>
                                    <title>bottom-part1</title>
                                    <g>
                                        <g data-name="Group 747">
                                            <path data-name="Path 294" class="cls-1 color-1"
                                                d="M0,24.21c120-55.74,214.32,2.57,267,0S349.18,7.4,349.18,7.4V82.35H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 297" class="cls-2 color-1"
                                                d="M350,34.21c-120-55.74-214.32,2.57-267,0S.82,17.4.82,17.4V92.35H350Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 296" class="cls-3 color-1"
                                                d="M0,44.21c120-55.74,214.32,2.57,267,0S349.18,27.4,349.18,27.4v74.95H0Z"
                                                transform="translate(0 0)" />
                                            <path data-name="Path 295" class="cls-4 color-1"
                                                d="M349.17,54.21c-120-55.74-214.32,2.57-267,0S0,37.4,0,37.4v74.95H349.17Z"
                                                transform="translate(0 0)" />
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <!-- single pricing -->
                    </div>
                </div>
                <!-- row -->
            </div>
            <!-- container -->
        </section>
        <!--====== PRICING STYLE ONE ENDS ======-->

        <div class="row justify-content-center">
            <div>
                <div class="pricing-btn rounded-buttons text-center mb-5">
                    <a class="btn btn-danger rounded-full" href="/">
                        Kembali
                    </a>
                </div>
            </div>
        </div>
    </div>

    {{ template "base/footer" . }}

    {{ template "components/loading" .}}

    {{ template "components/modal-infor" .}}
</body>

<script>
    // modal initiation
    const modalInfo = new bootstrap.Modal(document.getElementById('infoModal'));

    document.addEventListener("DOMContentLoaded", function() {
        const selectElement = document.getElementById("dynamicSelect");

        document.getElementById('loadingModal').style.display = 'flex';

        fetch('/baku-hantam-topic', {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading modal
                // console.log(data)
                document.getElementById('loadingModal').style.display = 'none';

                if (data.error) {
                    document.getElementById('modalMessage').innerHTML = data.message
                    modalInfo.show()
                } else {
                    // console.log("datanya: ", data)
                    data.Topic.forEach(item => {
                        // console.log(item)
                        const option = document.createElement("option");
                        option.value = item.link;
                        option.textContent = item.title;
                        selectElement.appendChild(option);
                    });
                    
                }
            })
            .catch((error) => {
                // Hide loading modal
                document.getElementById('loadingModal').style.display = 'none';

                // Show error message
                document.getElementById('modalMessage').innerHTML = data.message
                modalInfo.show()
            })
    });

    document.getElementById("postBakuHantam").addEventListener("submit", function(event) {
        const selectElement = document.getElementById("dynamicSelect"); 

        document.getElementById('loadingModal').style.display = 'flex';

        let cardInput = document.getElementById('cardInput');
        let cardResult = document.getElementById('cardResult');

        let topicNameRes = document.getElementById("topicNameRes");
        let linkCoordinat = document.getElementById("linkCoordinat");
        let resultRes = document.getElementById("resultRes");

        event.preventDefault(); 

        if (selectElement.value === "" || selectElement.value === "Pilih opsi") {
            document.getElementById('loadingModal').style.display = 'none';
            document.getElementById('modalMessage').innerHTML = '<p class="text-danger">' + "Pilih topik dulu kocak" + '</p>'
            modalInfo.show()
            return
        }

        const formData = new FormData(this);
        formData.append('topicName', selectElement.options[selectElement.selectedIndex].text);

        fetch('/baku-hantam', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading modal
                // console.log(data)
                document.getElementById('loadingModal').style.display = 'none';

                if (data.error) {
                    document.getElementById('modalMessage').innerHTML = data.message
                    modalInfo.show()
                } else {
                    console.log("datanya: ", data.Data)
                    console.log("datanya: ", data.TopicName)
                    console.log(cardInput)
                    console.log(cardResult)

                    cardInput.style.display = 'none';
                    cardResult.style.display = 'flex';

                    topicNameRes.innerHTML = data.TopicName;
                    linkCoordinat.href = data.Topic;
                    resultRes.innerHTML = data.Data;
                    
                }
            })
            .catch((error) => {
                // Hide loading modal
                document.getElementById('loadingModal').style.display = 'none';

                // Show error message
                document.getElementById('modalMessage').innerHTML = error.message
                modalInfo.show()
            })

    });
</script>